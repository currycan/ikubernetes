---
# install shadows ,docker-ce
- hosts: test
  sudo: yes
  sudo_user: root
  tasks:
  - name:  mkdir for shadows
    file: path={{ item }} state=directory
    with_items:
    - /etc/shadowsocks/

  - name: deploy shadows
    copy: src={{ item.src }} dest={{item.dest}} mode=770  owner=root group=root backup=yes
    with_items:
    - { src: '/opt/ikubernetes/ansible/files/shadows/shadowsocks.json', dest: '/etc/shadowsocks/shadowsocks.json' }
    - { src: '/opt/ikubernetes/ansible/files/shadows/proxychains.conf', dest: '/usr/local/etc/proxychains.conf' }
    - { src: '/opt/ikubernetes/ansible/files/shadows/proxychains4', dest: '/usr/local/bin/proxychains4' }
    - { src: '/opt/ikubernetes/ansible/files/shadows/ss', dest: '/usr/local/bin/ss' }
    - { src: '/opt/ikubernetes/ansible/files/shadows/sslocal', dest: '/usr/local/bin/sslocal' }
    - { src: '/opt/ikubernetes/ansible/files/shadows/libproxychains4.so', dest: '/usr/local/lib/libproxychains4.so' }
    - { src: '/opt/ikubernetes/ansible/files/rc.local', dest: '/etc/rc.local' }
  - name: 开机自启权限设置
    file: path=/etc/rc.d/rc.local mode=777
  - name: 启动ss
    shell: /usr/local/bin/ss &